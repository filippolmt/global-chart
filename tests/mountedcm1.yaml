deployment:
  enabled: true
  image:
    repository: nginx
    tag: "1.27.2"
    pullPolicy: IfNotPresent

  mountedConfigFiles:
    bundles:
      - mountDir: /etc/nginx/conf.d
        files:
          - name: nginx-static
            relPath: default.conf
            content: |
              server {
                listen 80;
                server_name _;

                root /usr/share/nginx/html;
                index index.html;

                location / {
                  try_files $uri $uri/ =404;
                }

                # Healthcheck usato dai probes
                location = /healthz {
                  access_log off;
                  return 200 "healthy\n";
                }

                gzip on;
                gzip_types text/css application/javascript application/json;
              }
          - name: extra-logs
            relPath: log.conf
            content: |
              # esempio di log custom
              log_format minimal '$remote_addr - $status "$request"';
              access_log /var/log/nginx/access.log minimal;
      - mountDir: /tmp/more-nginx
        files:
          - name: more-logs
            relPath: more-logs.conf
            content: |
              # altro esempio di log custom
              log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                              '$status $body_bytes_sent "$http_referer" '
                              '"$http_user_agent" "$http_x_forwarded_for"';
              access_log /var/log/nginx/access.log main;

  service:
    type: ClusterIP
    portName: http
    port: 80
    targetPort: http

  # Probe sullâ€™endpoint di health
  readinessProbe:
    httpGet:
      path: /healthz
      port: 80
    initialDelaySeconds: 2
    periodSeconds: 5
  livenessProbe:
    httpGet:
      path: /healthz
      port: 80
    initialDelaySeconds: 5
    periodSeconds: 10

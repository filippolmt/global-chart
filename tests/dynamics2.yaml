deployment:
  enabled: true
  image:
    repository: nginx
    tag: "1.27.2"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    portName: http
    port: 80
    targetPort: http

  readinessProbe:
    httpGet:
      path: /healthz
      port: 80
    initialDelaySeconds: 2
    periodSeconds: 5
  livenessProbe:
    httpGet:
      path: /healthz
      port: 80
    initialDelaySeconds: 5
    periodSeconds: 10

  mountedConfigFiles:
    files:
      - name: nginx-config
        filename: default.conf
        targetPath: /etc/nginx/conf.d/default.conf
        content: |
          server {
            listen 80;
            server_name _;
            root /usr/share/nginx/html;
            index index.html;
            location / {
              try_files $uri $uri/ =404;
            }
            # Healthcheck usato dai probes
            location = /healthz {
              access_log off;
              return 200 "healthy\n";
            }
            gzip on;
            gzip_types text/css application/javascript application/json;
          }
      - name: extra-logs
        filename: log.conf
        targetPath: /etc/nginx/conf.d/log.conf
        content: |
          # esempio di log custom
          log_format minimal '$remote_addr - $status "$request"';
          access_log /var/log/nginx/access.log minimal;
